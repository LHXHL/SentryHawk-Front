import{u as T}from"./useHandleData-DW4kA-As.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-D0RK73s3.js";import{d as P,i as m,r as b,g as I,o as A,w as i,b as l,a as g,u as p,_ as D,e as c,y as x,Z as w,m as O,c as S,n as B,p as C,q as M,s as N}from"./index-Bj5Pylhr.js";import{g as V,P as E,d as k,B as Z,a as R,e as U}from"./PocDialog-BoCSodzJ.js";import{f as q}from"./assets-DERgPz2g.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sortable.esm-C83syoBY.js";const W=P({__name:"index",setup(L,{expose:s}){const u=m(!1),r=m({title:"",tempApi:void 0,importApi:async t=>{try{return await(await fetch("/api/your-import-endpoint",{method:"POST",body:JSON.stringify(t)})).json()}catch(e){throw console.error("Import API Error:",e),new Error("Import API failed")}},getTableList:void 0,fileTypes:[],tipMessage:""}),f={url:"/api/poc/batchadd/",headers:{Authorization:localStorage.getItem("token")}},v=()=>{u.value=!0},d={type:"multipart"},h=t=>{const e=t.name.toLowerCase();return!e.endsWith(".yaml")&&!e.endsWith(".zip")?(x.error("只能上传 YAML 或 ZIP 格式的文件！"),!1):t.size/1024/1024<5?(e.endsWith(".zip")&&(["application/zip","application/x-zip-compressed","application/x-zip",""].includes(t.type)||t.type),!0):(x.error("上传文件大小不能超过 5MB！"),!1)},_=t=>{console.error("上传错误:",t),w({title:"温馨提示",message:`批量添加${r.value.title}失败，请您重新上传！`,type:"error"})},y=t=>{var e,a;t.code===200?(w({title:"温馨提示",message:`批量添加${r.value.title}成功！`,type:"success"}),(a=(e=r.value).getTableList)==null||a.call(e),u.value=!1):w({title:"温馨提示",message:t.msg||`批量添加${r.value.title}失败！`,type:"error"})};return s({open:v,acceptParams:r}),(t,e)=>{const a=b("el-icon"),o=b("el-upload"),n=b("el-dialog");return A(),I(n,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=z=>u.value=z),title:`批量导入${r.value.title}`,width:"30%"},{default:i(()=>[l(o,{class:"upload-demo",drag:"",action:f.url,headers:f.headers,name:"file",multiple:!0,data:d,accept:".yaml,.zip","on-success":y,"on-error":_,"before-upload":h},{tip:i(()=>e[1]||(e[1]=[g("div",{class:"el-upload__tip"},"支持上传 YAML 或 ZIP 格式的文件",-1)])),default:i(()=>[l(a,{class:"el-icon--upload"},{default:i(()=>[l(p(D))]),_:1}),e[2]||(e[2]=g("div",{class:"el-upload__text"},[c("将文件拖到此处，或"),g("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue","title"])}}}),Y={class:"main-box"},H={class:"table-box"},j=P({name:"useTreeFilter"}),te=P({...j,setup(L){const s=m(),r=O([{type:"selection",width:50},{prop:"poc_name",label:"POC名称",width:350,search:{el:"input"}},{prop:"author",label:"作者",width:200,search:{el:"input"}},{prop:"severity",label:"威胁等级",width:100,enum:[{type:"高危"},{type:"中危"},{type:"低危"}],search:{el:"select",props:{filterable:!0}},fieldNames:{label:"type",value:"type"}},{prop:"cvss_score",label:"cvss评分",width:200},{prop:"vendor",label:"供应商",width:200,search:{el:"input"}},{prop:"product",label:"产品",width:200,search:{el:"input"}},{prop:"tags",label:"标签",width:300,search:{el:"input"}},{prop:"add_time",label:"创建时间",width:170},{prop:"editor_time",label:"修改时间",width:170},{prop:"operation",label:"操作",width:210,fixed:"right"}]),f=async t=>{var e;await T(k,{id:[t.id]},`删除【${t.poc_name}】POC`),(e=s.value)==null||e.getTableList()},v=async t=>{var e,a;await T(k,{id:t},"删除所选poc"),(e=s.value)==null||e.clearSelection(),(a=s.value)==null||a.getTableList()},d=m(null),h=()=>{var t;d.value&&(d.value.acceptParams={title:"POC",tempApi:q,importApi:Z,getTableList:(t=s.value)==null?void 0:t.getTableList,fileTypes:[".yaml",".zip"],tipMessage:"支持上传 YAML 或 ZIP 格式的文件"},d.value.open())},_=m(null),y=(t,e={})=>{var o,n;const a={title:t,row:{...e},api:t==="新增"?R:t==="编辑"?U:void 0,getTableList:(o=s.value)==null?void 0:o.getTableList};(n=_.value)==null||n.acceptParams(a)};return(t,e)=>{const a=b("el-button");return A(),S("div",Y,[g("div",H,[l($,{ref_key:"proTable",ref:s,columns:r,"request-api":p(V),"search-col":{xs:1,sm:1,md:2,lg:3,xl:3}},{tableHeader:i(o=>[l(a,{type:"primary",icon:p(M),onClick:e[0]||(e[0]=n=>y("新增"))},{default:i(()=>e[1]||(e[1]=[c("新增POC")])),_:1},8,["icon"]),l(a,{type:"primary",icon:p(N),plain:"",onClick:h},{default:i(()=>e[2]||(e[2]=[c("批量添加POC")])),_:1},8,["icon"]),l(a,{type:"danger",icon:p(C),disabled:!o.isSelected,onClick:n=>v(o.selectedListIds)},{default:i(()=>e[3]||(e[3]=[c("批量删除POC")])),_:2},1032,["icon","disabled","onClick"])]),operation:i(o=>[l(a,{type:"primary",link:"",icon:p(B),onClick:n=>y("编辑",o.row)},{default:i(()=>e[4]||(e[4]=[c("编辑")])),_:2},1032,["icon","onClick"]),l(a,{type:"primary",link:"",icon:p(C),onClick:n=>f(o.row)},{default:i(()=>e[5]||(e[5]=[c("删除")])),_:2},1032,["icon","onClick"])]),_:1},8,["columns","request-api"]),l(E,{ref_key:"DialogRef",ref:_},null,512),l(W,{ref_key:"dialogRef",ref:d},null,512)])])}}});export{te as default};
